<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EDO ICHIBAï½œè‹¥æ—¦é‚£ãƒ»è‹¥å¥³å°† ãƒã‚¤ãƒšãƒ¼ã‚¸</title>

  <style>
    :root {
      --bg:#fbf7f0;           /* ç”Ÿæˆã‚Š(æ±Ÿæˆ¸ã£ã½ã„èƒŒæ™¯) */
      --panel:#ffffff;
      --border:#e5d9c8;
      --text:#1f2933;
      --sub:#6b7280;
      --brand:#1B365D;       /* æ±Ÿæˆ¸è— */ 
      --accent:#E8B4B8;      /* æ¡œãƒ”ãƒ³ã‚¯ */
      --accent2:#E63946;     /* æ±Ÿæˆ¸æœ± */
      --ok:#16a34a;
    }
    * { box-sizing:border-box; }

    body {
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI","Hiragino Sans","Noto Sans JP",sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }

    .wrap {
      max-width:720px;
      margin:0 auto;
      padding:12px 12px 80px;
    }

    header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:8px 4px 12px;
      gap:12px;
    }

    .brand {
      display:flex;
      align-items:center;
      gap:10px;
    }

    .brand-icon {
      width:36px;
      height:36px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 30%, #fff 0, #fff 35%, #E8B4B8 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.3rem;
    }

    .brand-text-title {
      margin:0;
      font-weight:800;
      letter-spacing:.06em;
      font-size:.95rem;
    }
    .brand-text-sub {
      margin:0;
      font-size:.78rem;
      color:var(--sub);
    }

    .kid-chip {
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.9);
      padding:6px 10px;
      font-size:.8rem;
      color:var(--sub);
      max-width:50%;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .card {
      background:var(--panel);
      border-radius:18px;
      border:1px solid var(--border);
      padding:14px 14px 16px;
      margin-bottom:12px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
    }

    .card-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
    }

    .card-title {
      font-size:1rem;
      font-weight:800;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .card-title span.emoji {
      font-size:1.2rem;
    }

    .card-sub {
      font-size:.8rem;
      color:var(--sub);
    }

    .pill {
      font-size:.75rem;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      color:var(--sub);
    }

    .big-num {
      font-size:1.7rem;
      font-weight:800;
      margin-bottom:4px;
    }

    .label {
      font-size:.8rem;
      color:var(--sub);
    }

    .kpi-row {
      display:flex;
      gap:8px;
      margin-top:10px;
    }

    .kpi {
      flex:1;
      border-radius:14px;
      border:1px solid var(--border);
      background:#fff7f7;
      padding:8px 10px;
    }

    .kpi-label {
      font-size:.75rem;
      color:var(--sub);
      margin-bottom:2px;
    }

    .kpi-value {
      font-size:1.1rem;
      font-weight:700;
    }

    .hint {
      font-size:.78rem;
      color:var(--sub);
      margin-top:6px;
    }

    /* ãŒã‚“ã°ã‚Šãƒ¡ãƒ¼ã‚¿ãƒ¼ */
    .meter-wrap {
      margin-top:6px;
    }
    .meter-bar {
      position:relative;
      width:100%;
      height:14px;
      border-radius:999px;
      background:#fde2e4;
      overflow:hidden;
    }
    .meter-fill {
      position:absolute;
      left:0;
      top:0;
      bottom:0;
      width:0%;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
      transition:width .6s ease-out;
    }
    .meter-text {
      margin-top:4px;
      font-size:.8rem;
      color:var(--sub);
    }

    /* ãƒŸãƒƒã‚·ãƒ§ãƒ³ */
    .mission-list {
      list-style:none;
      padding:0;
      margin:6px 0 0;
    }
    .mission-item {
      display:flex;
      align-items:flex-start;
      gap:8px;
      padding:6px 0;
    }
    .mission-check {
      width:18px;
      height:18px;
      border-radius:5px;
      border:2px solid var(--border);
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.9rem;
      cursor:pointer;
    }
    .mission-text-main {
      font-size:.9rem;
      margin-bottom:2px;
    }
    .mission-text-sub {
      font-size:.78rem;
      color:var(--sub);
    }
    .mission-item.done .mission-check {
      background:#bbf7d0;
      border-color:#22c55e;
    }

    /* ã•ã„ãã‚“ã®å£²ã‚ŒãŸã‚‚ã® */
    .list {
      list-style:none;
      padding:0;
      margin:6px 0 0;
    }
    .tx-item {
      display:flex;
      justify-content:space-between;
      gap:8px;
      padding:8px 0;
      border-bottom:1px solid #f1e4d6;
    }
    .tx-item:last-child {
      border-bottom:none;
    }
    .tx-main {
      flex:1;
    }
    .tx-title {
      font-size:.9rem;
      margin-bottom:2px;
    }
    .tx-sub {
      font-size:.78rem;
      color:var(--sub);
    }
    .tx-amt {
      white-space:nowrap;
      font-size:.95rem;
      font-weight:700;
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ã‚­ãƒ£ãƒ©å¸¯ */
    .footer-helpers {
      margin-top:4px;
      padding-top:6px;
      border-top:1px dashed rgba(148,163,184,0.4);
      font-size:.75rem;
      color:var(--sub);
      display:flex;
      gap:6px;
      align-items:center;
      flex-wrap:wrap;
    }
    .helper-badge {
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:3px 7px;
      border-radius:999px;
      background:#fff;
      border:1px solid #e5d9c8;
      font-size:.75rem;
    }

    .blocked {
      text-align:left;
      font-size:.88rem;
      line-height:1.7;
    }
    .blocked h1 {
      font-size:1.1rem;
      margin-bottom:6px;
    }

    /* === æ–°è¦è¿½åŠ ï¼šã“ã©ã‚‚å®Ÿç¸¾ === */
    .kids-header {
      text-align:center;
      margin-bottom:16px;
    }
    .kids-header h1 {
      font-size:1.3rem;
      font-weight:800;
      margin:0 0 8px;
      color:var(--brand);
    }
    .title-pill {
      display:inline-block;
      padding:6px 12px;
      border-radius:999px;
      background:#fff3c4;
      font-weight:bold;
      font-size:.85rem;
      margin-top:4px;
    }

    .kids-stats .stat-grid {
      display:grid;
      gap:12px;
      grid-template-columns:repeat(auto-fit, minmax(160px, 1fr));
      margin-top:10px;
    }
    .stat-card {
      background:#fff;
      border-radius:12px;
      padding:12px;
      box-shadow:0 1px 4px rgba(0,0,0,0.04);
      border:1px solid var(--border);
    }
    .stat-card .label {
      font-size:.75rem;
      color:#666;
      margin-bottom:4px;
    }
    .stat-card .value {
      font-size:1.3rem;
      font-weight:bold;
      margin-top:4px;
      color:var(--brand);
    }
    .stat-card .meter {
      margin-top:6px;
      width:100%;
      height:8px;
      border-radius:999px;
      background:#eee;
      overflow:hidden;
    }
    .stat-card .meter-bar {
      height:100%;
      width:0%;
      border-radius:999px;
      background:#ffb3b3;
      transition:width .4s ease;
    }

    /* ãƒãƒƒã‚¸ã¨ç§°å· */
    .badge-list, .title-list {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    .badge-chip {
      padding:6px 10px;
      border-radius:999px;
      background:#f4f0ff;
      font-size:.85rem;
      border:1px solid #e5d9c8;
    }
    .badge-chip.new {
      border:2px solid #ffcc33;
      background:#fffbeb;
    }
    .title-chip {
      padding:6px 10px;
      border-radius:999px;
      background:#e0f2fe;
      font-size:.85rem;
      border:1px solid #bae6fd;
    }

    /* === æ–°è¦è¿½åŠ ï¼šçµµæœ¬ãƒªãƒ³ã‚¯ === */
    .ehon-link {
      display: block;
      margin: 20px 0;
      font-size: 1.4rem;
      text-decoration: none;
      background: #ffe06b;
      color: #333;
      padding: 14px 20px;
      border-radius: 12px;
      font-weight: bold;
      text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .ehon-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* === æ–°è¦è¿½åŠ ï¼šãã‚‡ã†ã®ç›®æ¨™ã‚«ãƒ¼ãƒ‰ç”¨ CSS === */
    .goal-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#f9fafb;
      margin-bottom:6px;
    }
    .goal-main{
      flex:1;
    }
    .goal-title{
      font-size:.9rem;
      font-weight:600;
    }
    .goal-sub{
      font-size:.78rem;
      color:var(--sub);
    }
    .goal-count{
      font-size:.9rem;
      font-weight:700;
      min-width:60px;
      text-align:right;
    }
    .goal-row.done{
      background:#ecfdf3;
      border-color:#bbf7d0;
    }
    .goal-row.done .goal-count::after{
      content:" âœ…";
      font-size:.85rem;
    }

    @media (min-width:768px){
      .wrap { padding:16px 16px 90px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="brand-icon" aria-hidden="true">ğŸŒ¸</div>
        <div>
          <p class="brand-text-title">EDO ICHIBA</p>
          <p class="brand-text-sub">è‹¥æ—¦é‚£ãƒ»è‹¥å¥³å°† ãƒã‚¤ãƒšãƒ¼ã‚¸</p>
        </div>
      </div>
      <div class="kid-chip" id="kid-name">ãŠã¿ã›</div>
    </header>

    <!-- â–¼ æ–°è¦è¿½åŠ ï¼šè‹¥æ—¦é‚£/è‹¥å¥³å°† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
    <div class="kids-header">
      <h1>è‹¥æ—¦é‚£ / è‹¥å¥³å°† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <div id="currentTitle" class="title-pill">ç§°å·ï¼šã¾ã ã“ã‚Œã‹ã‚‰ï¼</div>
    </div>

    <!-- â–¼ æ–°è¦è¿½åŠ ï¼šçµµæœ¬ãƒªãƒ³ã‚¯ -->
    <a href="kids-ehon.html" class="ehon-link">
      ğŸ“˜ ã«ã‚“ã˜ã‚ƒãŸã„ã® ãˆã»ã‚“ ã‚’ã‚ˆã‚€
    </a>

    <!-- â–¼ æ–°è¦è¿½åŠ ï¼šã“ã©ã‚‚å®Ÿç¸¾ -->
    <section class="card kids-stats">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ“ˆ</span>
            <span>ãã‚‡ã†ã¾ã§ã® ã“ã©ã‚‚å®Ÿç¸¾</span>
          </div>
          <div class="card-sub">ã“ã‚Œã¾ã§ã® ãŒã‚“ã°ã‚Š</div>
        </div>
      </div>

      <div class="stat-grid">
        <div class="stat-card">
          <div class="label">å£²ã‚ŒãŸå›æ•°</div>
          <div class="value" id="statTotalOrders">0 å›</div>
        </div>
        <div class="stat-card">
          <div class="label">ã“ã©ã‚‚ ãŠå®¢ã•ã‚“</div>
          <div class="value" id="statChildCustomers">0 äºº</div>
        </div>
        <div class="stat-card">
          <div class="label">æµ·å¤–ã®ãŠå®¢ã•ã‚“</div>
          <div class="value" id="statInbound">0 äºº</div>
        </div>
        <div class="stat-card">
          <div class="label">ãƒ‡ãƒ¼ã‚¿åäººãƒ¡ãƒ¼ã‚¿ãƒ¼</div>
          <div class="value">
            <span id="statDataScoreValue">0</span> %
          </div>
          <div class="meter">
            <div id="dataScoreBar" class="meter-bar"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- â–¼ æ–°è¦è¿½åŠ ï¼šãƒãƒƒã‚¸ -->
    <section class="card kids-badges">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ…</span>
            <span>ã¦ã«ã„ã‚ŒãŸ ãƒãƒƒã‚¸</span>
          </div>
          <div class="card-sub">ã„ã¾ã¾ã§ ã‚²ãƒƒãƒˆ ã—ãŸã‚‚ã®</div>
        </div>
      </div>
      <div id="badgeList" class="badge-list">
        <!-- JSã§ãƒãƒƒã‚¸ã‚’è¿½åŠ  -->
      </div>
      <p class="hint">ãƒãƒƒã‚¸ã¯ ã‚ãªãŸ ã® ãŒã‚“ã°ã‚Š ã® ã‚ã‹ã— ã§ã™ã€‚ã‚‚ã£ã¨ ãµã‚„ãã†ï¼</p>
    </section>

    <!-- â–¼ æ–°è¦è¿½åŠ ï¼šç§°å· -->
    <section class="card kids-titles">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ‘‘</span>
            <span>ç§°å·</span>
          </div>
          <div class="card-sub">ã‚²ãƒƒãƒˆ ã—ãŸ ç§°å·ãŸã¡</div>
        </div>
      </div>
      <div id="titleList" class="title-list">
        <!-- JSã§ç§°å·ã‚’è¿½åŠ  -->
      </div>
      <p class="hint">ç§°å·ã¯ ã‚ãªãŸ ã® ãƒ¬ãƒ™ãƒ« ã‚’ ã‚ã‚‰ã‚ã—ã¾ã™ã€‚ã‚‚ã£ã¨ ã™ã”ã„ ç§°å·ã‚’ ã‚ã–ãã†ï¼</p>
    </section>

    <!-- â–¼ æ–°è¦è¿½åŠ ï¼šãã‚‡ã†ã®ç›®æ¨™ -->
    <section class="card" id="goal-card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ¯</span>
            <span>ãã‚‡ã†ã® ã‚‚ãã²ã‚‡ã†</span>
          </div>
          <div class="card-sub">è‹¥æ—¦é‚£ãƒ»è‹¥å¥³å°†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ ã¨ ã¤ãªãŒã£ã¦ã„ã¾ã™</div>
        </div>
      </div>

      <div class="goal-row" id="goal-row-cashless">
        <div class="goal-main">
          <div class="goal-title">QR / ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ ã‚’ 1å› ã—ã¦ã¿ã‚ˆã†</div>
          <div class="goal-sub">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¹ãƒãƒƒã‚¸ ã« ã¡ã‹ã¥ã ã‚‚ãã²ã‚‡ã†</div>
        </div>
        <div class="goal-count" id="goal-cashless-count">0 / 1</div>
      </div>

      <div class="goal-row" id="goal-row-attrs">
        <div class="goal-main">
          <div class="goal-title">ãŠãã‚ƒãã•ã‚“ã˜ã‚‡ã†ã»ã† ã‚’ 3äººåˆ† å…¥ã‚Œã¦ã¿ã‚ˆã†</div>
          <div class="goal-sub">ãƒ‡ãƒ¼ã‚¿åäººãƒ¡ãƒ¼ã‚¿ãƒ¼ ãŒ ä¸ŠãŒã‚‹ ã‚‚ãã²ã‚‡ã†</div>
        </div>
        <div class="goal-count" id="goal-attrs-count">0 / 3</div>
      </div>

      <p class="hint">
        ğŸ’¡ ç›®æ¨™ã¯ã€æ±ºæ¸ˆã®ã‚ã¨ã«å‡ºã¦ãã‚‹ã€Œã‹ã£ã¦ãã‚ŒãŸ ã²ã¨ã€ç”»é¢ ã‚„<br>
        ã€ŒQR / ã‚«ãƒ¼ãƒ‰ã§ ã¯ã‚‰ã†ã€ã® èª¬æ˜ ã¨ ãŠãªã˜å†…å®¹ã§ã™ã€‚
      </p>
    </section>

    <!-- â–¼ ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ï¼šãã‚‡ã†ã®å£²ä¸Š -->
    <section id="sec-main" class="card" aria-live="polite">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ’´</span>
            <span>ãã‚‡ã†ã® ã†ã‚Šã‚ã’</span>
          </div>
          <div class="card-sub" id="today-label">ãã‚‡ã† ã® ã†ã‚Šã‚ã’</div>
        </div>
        <div class="pill">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </div>
      </div>

      <div>
        <div class="big-num" id="total-sales">Â¥â€”</div>
        <div class="label" id="total-detail">â€” ä»¶ / ã¸ã„ãã‚“ Â¥â€”</div>
      </div>

      <div class="kpi-row">
        <div class="kpi">
          <div class="kpi-label">ãã‚‡ã† ã†ã‚ŒãŸ ã‹ãš</div>
          <div class="kpi-value" id="kpi-count">â€” ä»¶</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">ã„ã¡ã°ã‚“ ã­ã ã‚“ãŒ é«˜ã„ ã‚‚ã®</div>
          <div class="kpi-value" id="kpi-max">Â¥â€”</div>
        </div>
      </div>

      <p class="hint" id="main-hint">
        ãã‚‡ã†ã® å£²ä¸Š(ã™ã¹ã¦ã® æ±ºæ¸ˆ)ã‚’ ã‹ã‚“ãŸã‚“ã« è¦‹ã‚‰ã‚Œã‚‹ ç”»é¢ã§ã™ã€‚
      </p>
    </section>

    <!-- â–¼ ãŒã‚“ã°ã‚Šãƒ¡ãƒ¼ã‚¿ãƒ¼(ãƒ‡ãƒ¼ã‚¿ç²¾åº¦) -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ“Š</span>
            <span>ãŒã‚“ã°ã‚Š ãƒ¡ãƒ¼ã‚¿ãƒ¼</span>
          </div>
          <div class="card-sub">ãŠå®¢ã•ã‚“ã˜ã‚‡ã†ã»ã† ã® å…¥åŠ›ã©</div>
        </div>
      </div>

      <div class="meter-wrap">
        <div class="meter-bar">
          <div class="meter-fill" id="meter-fill"></div>
        </div>
        <div class="meter-text">
          ãã‚‡ã†ã® ãŒã‚“ã°ã‚Šï¼š<span id="meter-text">â€”%</span>
        </div>
      </div>

      <p class="hint">
        ã€Œæ—¥æœ¬ã®ã²ã¨ / å¤–å›½ã®ã²ã¨ã€ã€Œå¹´é½¢ã€ ãªã©ã‚’ å…¥ã‚Œã¦ãã‚Œã‚‹ã¨ã€<br>
        ãµãã‚ã†åšå£«ã¨ ä¸‰ç²¾éœŠãŒã€ã‚‚ã£ã¨ ã˜ã‚‡ã†ãšãª å£²ã‚Šã‹ãŸã‚’ æ•™ãˆã¦ãã‚Œã¾ã™ã€‚
      </p>

      <div class="footer-helpers">
        <span>ã„ã£ã—ã‚‡ã« ãŠã¦ã¤ã ã„ï¼š</span>
        <span class="helper-badge">ğŸŒ¸ ã‚­ãƒ¢ãƒ‹ãƒ£(ã¿ã¤ã‘ã‚‹ä¿‚)</span>
        <span class="helper-badge">ğŸ¥· ãƒ‹ãƒ³ã‚·ãƒ£(ã‹ã¡ ã‚’ ã¾ã‚‚ã‚‹ä¿‚)</span>
        <span class="helper-badge">ğŸ± ãƒã‚³ãƒãƒ«(ãŠã†ãˆã‚“ä¿‚)</span>
      </div>
    </section>

    <!-- â–¼ ãã‚‡ã†ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ¯</span>
            <span>ãã‚‡ã†ã® ãƒŸãƒƒã‚·ãƒ§ãƒ³</span>
          </div>
          <div class="card-sub">ä¸‰ã¤ ã§ããŸã‚‰ 100ç‚¹ï¼</div>
        </div>
      </div>

      <ul class="mission-list" id="mission-list">
        <li class="mission-item">
          <div class="mission-check" data-mission="1">âœ“</div>
          <div>
            <div class="mission-text-main">ãŠå®¢ã•ã‚“ã«ã€Œã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼ã€ã¨ ã„ãˆãŸ</div>
            <div class="mission-text-sub">ã•ã„ã—ã‚‡ã® ã²ã¨ã“ã¨ã‚’ å…ƒæ°—ã« ã„ã£ã¦ã¿ã‚ˆã†</div>
          </div>
        </li>
        <li class="mission-item">
          <div class="mission-check" data-mission="2">âœ“</div>
          <div>
            <div class="mission-text-main">å€¤ä¸‹ã’ã‚’ ã­ãŒã‚ã‚ŒãŸã‚‰ ã€Œã”ã‚ã‚“ãªã•ã„ã€ã¨ ä¼ãˆã‚‰ã‚ŒãŸ</div>
            <div class="mission-text-sub">ã­ãã‚Š ã‚’ ã“ã¨ã‚ã‚‹ ã‚Œã‚“ã—ã‚…ã†(ç¾é‡‘ãƒˆãƒ©ãƒ–ãƒ« ã‚ˆã‘)</div>
          </div>
        </li>
        <li class="mission-item">
          <div class="mission-check" data-mission="3">âœ“</div>
          <div>
            <div class="mission-text-main">1å› QR / ã‚«ãƒ¼ãƒ‰ ã§ ã†ã£ã¦ã¿ãŸ</div>
            <div class="mission-text-sub">ç¾é‡‘ãŒ ãªãã¦ã‚‚ è²·ãˆã‚‹ã‚ˆã†ã« ã—ã¦ã‚ã’ã‚ˆã†</div>
          </div>
        </li>
      </ul>

      <p class="hint" id="mission-hint">
        ãƒŸãƒƒã‚·ãƒ§ãƒ³ã¯ ã“ã®ã‚¹ãƒãƒ›ã ã‘ã§ è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚<br>
        ãªããªã£ã¦ã‚‚ å¤§ä¸ˆå¤«ãªã®ã§ã€æ°—æ¥½ã« ã‚¿ãƒƒãƒ—ã—ã¦ OK ã§ã™ã€‚
      </p>
    </section>

    <!-- â–¼ ã•ã„ãã‚“ ã†ã‚ŒãŸ ã‚‚ã® -->
    <section class="card">
      <div class="card-header">
        <div>
          <div class="card-title">
            <span class="emoji">ğŸ›ï¸</span>
            <span>ã•ã„ãã‚“ ã†ã‚ŒãŸ ã‚‚ã®</span>
          </div>
          <div class="card-sub">3ä»¶ã ã‘ ã²ã‚‡ã†ã˜</div>
        </div>
      </div>

      <ul class="list" id="recent-list">
        <!-- JSã§ ã†ã‚ã“ã¿ -->
      </ul>

      <p class="hint" id="recent-hint">
        ä½•ãŒ ã„ã¡ã°ã‚“ ã†ã‚Œã¦ã„ã‚‹ã‹ ã‚’ è¦‹ã¦ã¿ã‚ˆã†ã€‚<br>
        ãŸãã•ã‚“ ã†ã‚Œã¦ã„ã‚‹ ã‚‚ã® ã‚’ æ‰‹å‰ã« ãªã‚‰ã¹ã¦ã¿ã‚‹ ã®ã‚‚ ã‚³ãƒ„ã§ã™ã€‚
      </p>
    </section>

    <!-- â–¼ ã‚µãƒ–ã‚¹ã‚¯ä»¥å¤–ã®ãƒ–ãƒ­ãƒƒã‚¯è¡¨ç¤º -->
    <section class="card" id="block-message" style="display:none;">
      <div class="blocked">
        <h1>ã“ã®ç”»é¢ã¯ã€Œã‚­ãƒƒã‚ºãƒ—ãƒ©ãƒ³ã€å°‚ç”¨ã§ã™</h1>
        <p>
          è‹¥æ—¦é‚£ãƒ»è‹¥å¥³å°†ãƒã‚¤ãƒšãƒ¼ã‚¸ã¯ã€EDO ICHIBA ã‚­ãƒƒã‚ºãƒ—ãƒ©ãƒ³ ã”å¥‘ç´„ä¸­ã®<br>
          å‡ºåº—è€…ã•ã¾å‘ã‘ã® ç”»é¢ã§ã™ã€‚
        </p>
        <p>
          ãƒ—ãƒ©ãƒ³ã® ãã‚ã—ã„å†…å®¹ã‚„ ãŠç”³ã—è¾¼ã¿ã¯ã€<br>
          EDO ICHIBA / FleaPay é‹å–¶ã¾ã§ ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
        </p>
      </div>
    </section>
  </div>

  <script>
    (function(){
      const $ = s => document.querySelector(s);
      const $$ = s => document.querySelectorAll(s);

      const params   = new URLSearchParams(location.search);
      const sellerId = params.get("s") || "";

      const kidNameEl    = $("#kid-name");
      const todayLabelEl = $("#today-label");
      const totalSalesEl = $("#total-sales");
      const totalDetailEl= $("#total-detail");
      const kpiCountEl   = $("#kpi-count");
      const kpiMaxEl     = $("#kpi-max");
      const mainHintEl   = $("#main-hint");

      const meterFillEl  = $("#meter-fill");
      const meterTextEl  = $("#meter-text");

      const missionListEl= $("#mission-list");
      const recentListEl = $("#recent-list");
      const recentHintEl = $("#recent-hint");

      const mainCardEl   = $("#sec-main");
      const blockEl      = $("#block-message");

      // æ–°è¦è¿½åŠ ï¼šãã‚‡ã†ã®ç›®æ¨™ã‚«ãƒ¼ãƒ‰ç”¨ã®è¦ç´ å‚ç…§
      const goalCashlessRowEl = $("#goal-row-cashless");
      const goalAttrsRowEl    = $("#goal-row-attrs");
      const goalCashlessEl    = $("#goal-cashless-count");
      const goalAttrsEl       = $("#goal-attrs-count");

      if (!sellerId) {
        if (mainHintEl) {
          mainHintEl.textContent = "URLã®ã•ã„ã”ã« ?s=å‡ºåº—è€…ID ã‚’ ã¤ã‘ã¦ãã ã•ã„ã€‚";
        }
        return;
      }

      function formatYen(n){
        if (!Number.isFinite(n)) return "Â¥â€”";
        return "Â¥" + n.toLocaleString("ja-JP");
      }

      function formatDateJp(date){
        const w = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][date.getDay()];
        return `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${date.getDate()}æ—¥(${w})`;
      }

      // ãã‚‡ã† ã® ãƒ©ãƒ™ãƒ«
      const nowJst = new Date(new Date().toLocaleString("en-US",{ timeZone:"Asia/Tokyo" }));
      if (todayLabelEl) {
        todayLabelEl.textContent = formatDateJp(nowJst) + " ã® ã†ã‚Šã‚ã’";
      }

      // ====== æ–°è¦è¿½åŠ ï¼šã“ã©ã‚‚å®Ÿç¸¾ã‚µãƒãƒªãƒ¼ã‚’èª­ã¿è¾¼ã‚€ ======
      async function loadKidsSummary() {
        try {
          const res = await fetch(`/api/seller/kids-summary?s=${encodeURIComponent(sellerId)}`);
          if (!res.ok) {
            console.warn("kids-summary API error:", res.status);
            return;
          }
          const data = await res.json();

          const stats = data.stats || {};
          const badges = data.badges || [];
          const titles = data.titles || [];

          // æ•°å­—ç³»
          $("#statTotalOrders").textContent = (stats.totalOrders || 0) + " å›";
          $("#statChildCustomers").textContent = (stats.childCustomerCount || 0) + " äºº";
          $("#statInbound").textContent = (stats.inboundCount || 0) + " äºº";

          const ds = stats.dataScore || 0;
          $("#statDataScoreValue").textContent = ds;
          $("#dataScoreBar").style.width = Math.min(ds, 100) + "%";

          // ç§°å·(ã„ã¡ã°ã‚“æ–°ã—ã„ã‚‚ã®ã‚’è¡¨ç¤º)
          const titleEl = $("#currentTitle");
          if (titles.length > 0) {
            // first_earned_at ã§ã‚½ãƒ¼ãƒˆ(æ–°ã—ã„é †)
            titles.sort((a, b) => {
              const ta = a.first_earned_at ? new Date(a.first_earned_at).getTime() : 0;
              const tb = b.first_earned_at ? new Date(b.first_earned_at).getTime() : 0;
              return tb - ta;
            });
            titleEl.textContent = "ç§°å·ï¼š" + titles[0].label;
          } else {
            titleEl.textContent = "ç§°å·ï¼šã¾ã ã“ã‚Œã‹ã‚‰ï¼";
          }

          // ãƒãƒƒã‚¸ä¸€è¦§
          const badgeList = $("#badgeList");
          badgeList.innerHTML = "";
          if (badges.length === 0) {
            badgeList.innerHTML = '<div class="hint">ã¾ã  ãƒãƒƒã‚¸ãŒ ã‚ã‚Šã¾ã›ã‚“ã€‚ãŒã‚“ã°ã£ã¦ ã‚²ãƒƒãƒˆ ã—ã‚ˆã†ï¼</div>';
          } else {
            badges.forEach((b) => {
              const div = document.createElement("div");
              div.className = "badge-chip";
              div.textContent = b.label;
              badgeList.appendChild(div);
            });
          }

          // ç§°å·ä¸€è¦§
          const titleList = $("#titleList");
          titleList.innerHTML = "";
          if (titles.length === 0) {
            titleList.innerHTML = '<div class="hint">ã¾ã  ç§°å·ãŒ ã‚ã‚Šã¾ã›ã‚“ã€‚ãŒã‚“ã°ã£ã¦ ã‚²ãƒƒãƒˆ ã—ã‚ˆã†ï¼</div>';
          } else {
            titles.forEach((t) => {
              const div = document.createElement("div");
              div.className = "title-chip";
              div.textContent = t.label;
              titleList.appendChild(div);
            });
          }
        } catch (e) {
          console.error("loadKidsSummary error", e);
        }
      }

      async function loadSummary(){
        try{
          const res = await fetch(`/api/seller/summary?s=${encodeURIComponent(sellerId)}`);
          const data = await res.json();

          if (!res.ok){
            console.error("summary error", data);
            if (mainHintEl) mainHintEl.textContent = "ãƒ‡ãƒ¼ã‚¿ã® ã‚ˆã¿ã“ã¿ ã« ã—ã£ã±ã„ã—ã¾ã—ãŸã€‚";
            return;
          }

          // ã‚µãƒ–ã‚¹ã‚¯åˆ¶å¾¡ï¼škidsä»¥å¤–ã¯ãƒ–ãƒ­ãƒƒã‚¯
          if (
            data &&
            (data.isSubscribed === false ||
             !data.planType ||
             data.planType !== "kids")
          ){
            if (mainCardEl) mainCardEl.style.display = "none";
            if (blockEl)    blockEl.style.display    = "block";
            return;
          }

          // åº—åè¡¨ç¤º
          const disp = data.displayName || data.sellerId || "ãŠã¿ã›";
          if (kidNameEl) kidNameEl.textContent = disp + " ã® è‹¥æ—¦é‚£ / è‹¥å¥³å°†";

          // å£²ä¸ŠKPI
          const total = Number(data.salesToday || 0);
          const count = Number(data.countToday || 0);
          const avg   = Number(data.avgToday   || 0);

          if (totalSalesEl) totalSalesEl.textContent = formatYen(total);
          if (totalDetailEl) {
            totalDetailEl.textContent =
              `${count}ä»¶ / ã¸ã„ãã‚“ ${formatYen(avg || 0)}`;
          }
          if (kpiCountEl) kpiCountEl.textContent = `${count} ä»¶`;

          // ã„ã¡ã°ã‚“é«˜ã„é‡‘é¡(ä»Šæ—¥ã®å–å¼•ã‹ã‚‰ã–ã£ãã‚Š)
          let maxAmount = 0;
          if (Array.isArray(data.recent)) {
            data.recent.forEach(tx => {
              const amt = Number(tx.amount || tx.net_amount || 0);
              if (amt > maxAmount) maxAmount = amt;
            });
          }
          if (kpiMaxEl) kpiMaxEl.textContent = maxAmount ? formatYen(maxAmount) : "Â¥â€”";

          if (count === 0 && mainHintEl){
            mainHintEl.textContent = "ãã‚‡ã† ã® ã†ã‚Šã‚ã’ ã¯ ã¾ã  0 ä»¶ã§ã™ã€‚ã•ã„ã—ã‚‡ã® 1ä»¶ ã‚’ ç›®æŒ‡ãã†ï¼";
          }

          // ãŒã‚“ã°ã‚Šãƒ¡ãƒ¼ã‚¿ãƒ¼(dataScoreã‚’ãã®ã¾ã¾%è¡¨ç¤º)
          const score = typeof data.dataScore === "number" ? data.dataScore : null;
          if (score != null) {
            const clamped = Math.max(0, Math.min(100, score));
            if (meterFillEl) meterFillEl.style.width = clamped + "%";
            if (meterTextEl) meterTextEl.textContent = clamped + "%";
          } else {
            if (meterTextEl) meterTextEl.textContent = "â€”%";
          }

          // â–¼ ã“ã“ã‹ã‚‰ ãã‚‡ã†ã®ç›®æ¨™ã®ãŸã‚ã®é›†è¨ˆ â–¼

          // ãã‚‡ã†ã®æ—¥ä»˜ï¼ˆJSTï¼‰ã‚’ YYYY-MM-DD æ–‡å­—åˆ—ã«
          const todayStr = nowJst.toISOString().slice(0,10);

          let cashlessToday = 0;
          let attrsToday    = 0;

          (data.recent || []).forEach(tx => {
            if (!tx.createdAt) return;

            // createdAt ã‚’ JST ã«ã‚ˆã›ã¦æ—¥ä»˜ã ã‘æ¯”è¼ƒ
            const created = new Date(tx.createdAt);
            const jst = new Date(created.toLocaleString("en-US", { timeZone:"Asia/Tokyo" }));
            const dStr = jst.toISOString().slice(0,10);
            if (dStr !== todayStr) return;

            // QR / ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆï¼ˆpaymentMethod === 'card' ã‚’æƒ³å®šï¼‰
            if (tx.paymentMethod === "card") {
              cashlessToday++;
            }

            // è³¼å…¥è€…å±æ€§ãŒ 1ã¤ã§ã‚‚å…¥ã£ã¦ã„ã‚Œã°ã‚«ã‚¦ãƒ³ãƒˆ
            const hasAttr =
              tx.customerType && tx.customerType !== "unknown" ||
              tx.gender       && tx.gender       !== "unknown" ||
              tx.ageBand      && tx.ageBand      !== "unknown";

            if (hasAttr) {
              attrsToday++;
            }
          });

          const GOAL_CASHLESS = 1;
          const GOAL_ATTRS    = 3;

          if (goalCashlessEl) {
            goalCashlessEl.textContent = `${cashlessToday} / ${GOAL_CASHLESS}`;
          }
          if (goalAttrsEl) {
            goalAttrsEl.textContent = `${attrsToday} / ${GOAL_ATTRS}`;
          }

          if (goalCashlessRowEl) {
            goalCashlessRowEl.classList.toggle("done", cashlessToday >= GOAL_CASHLESS);
          }
          if (goalAttrsRowEl) {
            goalAttrsRowEl.classList.toggle("done", attrsToday >= GOAL_ATTRS);
          }

          // â–¼ ã“ã“ã¾ã§ ãã‚‡ã†ã®ç›®æ¨™ â–¼

          // ã•ã„ãã‚“ã® å–å¼•3ä»¶
          if (recentListEl){
            recentListEl.innerHTML = "";
            const list = (data.recent || []).slice(0,3);
            if (!list.length){
              const li = document.createElement("li");
              li.className = "tx-item";
              li.innerHTML = `
                <div class="tx-main">
                  <div class="tx-title">ã¾ã  ã†ã‚ŒãŸ ã‚‚ã® ãŒ ã‚ã‚Šã¾ã›ã‚“</div>
                  <div class="tx-sub">ã¯ã˜ã‚ã¦ ã® 1ä»¶ãŒ ã“ã“ã« ã²ã‚‡ã†ã˜ã•ã‚Œã¾ã™ã€‚</div>
                </div>
              `;
              recentListEl.appendChild(li);
            } else {
              list.forEach(tx => {
                const li = document.createElement("li");
                li.className = "tx-item";

                const summary = (tx.summary || "ã—ã‚‡ã†ã²ã‚“").split("\n")[0];
                const amt = Number(tx.amount || tx.net_amount || 0);

                li.innerHTML = `
                  <div class="tx-main">
                    <div class="tx-title">${summary}</div>
                    <div class="tx-sub">
                      ${amt ? "ã“ã® ã¨ã ã® ãŠã‹ã„ã‚‚ã®" : "é‡‘é¡ãƒ‡ãƒ¼ã‚¿ ãªã—"}
                    </div>
                  </div>
                  <div class="tx-amt">${formatYen(amt || 0)}</div>
                `;
                recentListEl.appendChild(li);
              });
            }
          }

          if (recentHintEl){
            recentHintEl.textContent = "ã•ã„ãã‚“ ã® 3ä»¶ ã‚’ ã²ã‚‡ã†ã˜ã—ã¦ã„ã¾ã™ã€‚ãªã«ãŒ äººæ°—ã‹ è¦‹ã¦ã¿ã‚ˆã†ã€‚";
          }

        } catch(e){
          console.error("loadSummary error", e);
          if (mainHintEl) mainHintEl.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒ ç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ ã‹ãã«ã‚“ ã—ã¦ãã ã•ã„ã€‚";
        }
      }

      // ãƒŸãƒƒã‚·ãƒ§ãƒ³ã®ãƒã‚§ãƒƒã‚¯(ãƒ­ãƒ¼ã‚«ãƒ«ã ã‘)
      function initMissions(){
        if (!missionListEl) return;
        const keyPrefix = `kids-mission-${sellerId}-`;

        missionListEl.querySelectorAll(".mission-item").forEach(item => {
          const check = item.querySelector(".mission-check");
          if (!check) return;
          const id = check.getAttribute("data-mission");
          const key = keyPrefix + id;

          const saved = localStorage.getItem(key);
          if (saved === "done") {
            item.classList.add("done");
          }

          check.addEventListener("click", () => {
            const done = item.classList.toggle("done");
            localStorage.setItem(key, done ? "done" : "todo");
          });
        });
      }

      initMissions();
      loadSummary();
      loadKidsSummary(); // æ–°è¦è¿½åŠ ï¼šã“ã©ã‚‚å®Ÿç¸¾ã‚’èª­ã¿è¾¼ã‚€
    })();
  </script>
</body>
</html>