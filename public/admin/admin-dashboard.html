<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | Fleapay Admin</title>
  
  <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ -->
  <meta name="robots" content="noindex,nofollow">
  <meta http-equiv="Cache-Control" content="no-store">
  <meta http-equiv="X-Frame-Options" content="DENY">
  
  <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <link rel="stylesheet" href="common/admin-base.css">
  <script src="common/admin-utils.js"></script>
</head>
<body>
  <!-- å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="admin-header">
    <div>
      <span style="font-weight: 700; color: var(--fleapay-blue);">Fleapay Admin</span>
      <span class="env-badge">ENV</span>
    </div>
    <div>
      <span style="font-size: 13px; color: var(--fleapay-gray);">admin@fleapay.jp â–¼</span>
    </div>
  </header>

  <div class="admin-container">
    <!-- å…±é€šã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <nav class="admin-sidebar">
      <ul class="nav-menu">
        <li><a href="admin-dashboard.html" class="nav-item" data-page="dashboard">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></li>
        <li><a href="admin-sellers.html" class="nav-item" data-page="sellers">ğŸ‘¥ å‡ºåº—è€…</a></li>
        <li><a href="admin-frames.html" class="nav-item" data-page="frames">ğŸ¨ AIãƒ•ãƒ¬ãƒ¼ãƒ </a></li>
        <li><a href="admin-payments.html" class="nav-item" data-page="payments">ğŸ’³ æ±ºæ¸ˆãƒ»CBç®¡ç†</a></li>
      </ul>
    </nav>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="admin-content">
      <section>
        <div class="sec-title-row">
          <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
          <span class="pill">ãƒ›ãƒ¼ãƒ </span>
        </div>
        
        <!-- ãƒ•ã‚£ãƒ«ã‚¿ -->
        <div style="display: flex; gap: 16px; margin-bottom: 20px;">
          <select id="periodFilter" style="padding: 8px; border-radius: 8px;">
            <option value="today">ä»Šæ—¥</option>
            <option value="week">ä»Šé€±</option>
            <option value="month">ä»Šæœˆ</option>
          </select>
          <select id="eventFilter" style="padding: 8px; border-radius: 8px;">
            <option value="all">å…¨ã‚¤ãƒ™ãƒ³ãƒˆ</option>
            <option value="oi-flea">å¤§äº•ãƒ•ãƒªãƒ</option>
          </select>
          <button id="refreshBtn" class="ghost">ğŸ”„ æ›´æ–°</button>
        </div>
      </section>

      <!-- ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¡¨ç¤º -->
      <div class="grid">
        <section>
          <h2>ä»Šæ—¥ã®æ±ºæ¸ˆã‚µãƒãƒª</h2>
          <div style="font-size: 28px; font-weight: 700; color: var(--fleapay-blue); margin: 12px 0;">
            <span id="paymentCount">120</span><span style="font-size: 16px; margin-left: 4px;">ä»¶</span>
          </div>
          <div style="font-size: 14px; color: var(--fleapay-gray);">
            å£²ä¸Šåˆè¨ˆ: <span id="totalRevenue">Â¥450,000</span><br>
            ç´”å£²ä¸Š: <span id="netRevenue">Â¥410,000</span>
          </div>
        </section>
        
        <section>
          <h2>ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ / è¿”é‡‘</h2>
          <div style="font-size: 28px; font-weight: 700; color: var(--warning-amber); margin: 12px 0;">
            <span id="disputeCount">2</span><span style="font-size: 16px; margin-left: 4px;">ä»¶</span>
          </div>
          <div style="font-size: 14px; color: var(--fleapay-gray);">
            è¿”é‡‘: <span id="refundCount">5ä»¶</span><br>
            æœŸé™é–“è¿‘: <span id="urgentCount" style="color: var(--error-maroon);">1ä»¶ ğŸ””</span>
          </div>
        </section>
      </div>

      <!-- ã‚¢ãƒ©ãƒ¼ãƒˆ -->
      <section>
        <h2>æœ€è¿‘ã®ã‚¢ãƒ©ãƒ¼ãƒˆ</h2>
        <div id="alertsList">
          <div class="err" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <strong>âš ï¸ ãƒãƒ£ãƒ¼ã‚¸ãƒãƒƒã‚¯ 1ä»¶ï¼ˆæœŸé™ã¾ã§ 3æ—¥ï¼‰</strong><br>
              <small>seller-abc123 / Â¥5,000 / å¯¾å¿œãŒå¿…è¦</small>
            </div>
            <button class="small">å¯¾å¿œ</button>
          </div>
        </div>
      </section>

      <!-- å‡ºåº—è€…ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ -->
      <section>
        <h2>å‡ºåº—è€…ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</h2>
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: var(--fleapay-cream);">
                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #eee;">å‡ºåº—è€…ID</th>
                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #eee;">åº—å</th>
                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #eee;">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #eee;">æœ€çµ‚åˆ©ç”¨</th>
              </tr>
            </thead>
            <tbody id="recentSellers">
              <tr>
                <td style="padding: 10px; border-bottom: 1px solid #eee;">seller-abc123</td>
                <td style="padding: 10px; border-bottom: 1px solid #eee;">èŠ±å­å•†åº—</td>
                <td style="padding: 10px; border-bottom: 1px solid #eee;">
                  <span style="background: #f0f9f4; color: var(--success-green); padding: 2px 8px; border-radius: 12px; font-size: 12px;">åˆ©ç”¨å¯</span>
                </td>
                <td style="padding: 10px; border-bottom: 1px solid #eee;">2025/11/13 14:30</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å›ºæœ‰ã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', async () => {
      await loadDashboardData();
      setupEventListeners();
      startAutoRefresh();
    });

    async function loadDashboardData() {
      try {
        const data = await adminAPI.request('/admin/dashboard');
        updateMetrics(data);
      } catch (error) {
        adminUI.showToast('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    function updateMetrics(data) {
      document.getElementById('paymentCount').textContent = data.paymentCount || 0;
      document.getElementById('totalRevenue').textContent = adminUI.formatCurrency(data.totalRevenue || 0);
      document.getElementById('netRevenue').textContent = adminUI.formatCurrency(data.netRevenue || 0);
    }

    function setupEventListeners() {
      document.getElementById('refreshBtn').addEventListener('click', loadDashboardData);
      document.getElementById('periodFilter').addEventListener('change', loadDashboardData);
    }

    function startAutoRefresh() {
      setInterval(loadDashboardData, 300000); // 5åˆ†ã”ã¨
    }
  </script>
</body>
</html>