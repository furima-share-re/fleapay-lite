# Phase 1.8: データ量の実際の確認結果

**確認日**: 2026-01-04  
**ファイル**: `tmp/2026-01-03T15_42Z.dir.tar.gz`

---

## 📊 ファイル情報（実際の確認結果）

### 圧縮ファイル

- **ファイル名**: `2026-01-03T15_42Z.dir.tar.gz`
- **ファイルサイズ**: **約65.85MB** (69,044,659バイト)
- **形式**: PostgreSQLカスタム形式（圧縮済み）

### 展開後のファイル

**ファイル数**: 12個（`toc.dat` + 11個の`.dat`ファイル）

**実際のファイルサイズ**（確認済み）:

| ファイル名 | サイズ (MB) | 説明 |
|-----------|------------|------|
| `3544.dat` | **87.02** | 主要なデータテーブル（最も大きい） |
| `3541.dat` | 0.09 | 小規模テーブル |
| `3540.dat` | 0.03 | 小規模テーブル |
| `toc.dat` | 0.03 | テーブルオブジェクトカタログ |
| `3547.dat` | 0.01 | 小規模テーブル |
| `3546.dat` | 0.01 | 小規模テーブル |
| その他6ファイル | 0.00 | 空または非常に小さい |

**合計展開サイズ**: **87.2 MB**
**圧縮ファイルサイズ**: **65.85 MB**
**圧縮率**: **75.5%**

---

## 📦 展開後のファイル構造

### ディレクトリ構造

```
tmp/
└── 2026-01-03T15:42Z/
    └── fleapay_prod_db/
        ├── toc.dat (テーブルオブジェクトカタログ)
        ├── 3538.dat
        ├── 3539.dat
        ├── 3540.dat
        ├── 3541.dat
        ├── 3543.dat
        ├── 3544.dat
        ├── 3545.dat
        ├── 3546.dat
        ├── 3547.dat
        ├── 3549.dat
        └── 3550.dat
```

**ファイル数**: 12個（`toc.dat` + 11個の`.dat`ファイル）

---

## 📈 データ量の実際の確認結果

### 展開後のサイズ（実際の測定値）

- **圧縮ファイル**: 約65.85MB
- **展開後のサイズ**: **約87.2MB**（実際の測定値）
- **圧縮率**: **75.5%**（実際の測定値）

**重要な発見**:
- 最大のファイル（`3544.dat`）が**87.02MB**と非常に大きい
- この1つのファイルが全体の約99.8%を占めている
- 他のファイルはほとんど空または非常に小さい

### テーブルごとのデータ量推定

**11個の`.dat`ファイル**があることから、主要なテーブルが含まれていると推定されます。

**推定されるテーブル**:
- `sellers` - セラー情報
- `orders` - 注文情報（最も大きい可能性）
- `stripe_payments` - 決済情報
- `order_items` - 注文明細
- `order_metadata` - 注文メタデータ
- `buyer_attributes` - 購入者属性
- `images` - 画像情報
- `qr_sessions` - QRセッション
- `frames` - フレーム情報
- `kids_achievements` - キッズ実績
- `seller_subscriptions` - セラーサブスクリプション

---

## 🔄 SQL形式への変換見積もり

### 変換後のファイルサイズ見積もり

| 項目 | サイズ |
|------|--------|
| **現在のファイル（.dir.tar.gz）** | **65.85MB**（実際の測定値） |
| **展開後のサイズ（.dir形式）** | **87.2MB**（実際の測定値） |
| **SQL形式への変換後** | **約170-260MB**（推定） |

**計算根拠**:
- PostgreSQLカスタム形式（バイナリ）→ SQL形式（テキスト）への変換
- INSERT文やCOPY文が含まれるため、ファイルサイズが2-3倍に増加
- 約87.2MB × 2-3倍 = 約170-260MB

**計算根拠**:
- PostgreSQLカスタム形式（バイナリ）→ SQL形式（テキスト）への変換
- INSERT文やCOPY文が含まれるため、ファイルサイズが2-3倍に増加
- 約100-150MB × 2-3倍 = 約200-400MB

---

## ⚠️ Supabase SQL Editorでの実行可能性

### 制限事項

| 項目 | 制限値 | 現在のファイル |
|------|--------|---------------|
| **推奨サイズ** | 10MB以下 | ❌ 170-260MB（17-26倍） |
| **最大サイズ** | 約50MB | ❌ 170-260MB（3.4-5.2倍） |
| **タイムアウト** | 30秒-2分 | ❌ 数時間かかる見込み |

### 結論

**❌ SQL形式への変換は実行不可能**

**理由**:
1. ファイルサイズが大きすぎる（約170-260MB）
2. Supabase SQL Editorの制限（10MB推奨、50MB最大）を大幅に超える（3.4-5.2倍）
3. ブラウザがクラッシュする可能性が高い
4. タイムアウトのリスクが非常に高い
5. **最大のファイル（87.02MB）だけでも、SQL形式に変換すると約170-260MBになる見込み**

---

## 📊 方法別の比較（実際のデータ量ベース）

| 方法 | ファイルサイズ | Supabase SQL Editorで実行可能？ | 所要時間 | リスク |
|------|--------------|-------------------------------|---------|--------|
| **pg_restore（.dir.tar.gz）** | 65.85MB（圧縮）<br>87.2MB（展開） | ❌ 不要（コマンドライン） | 1-3時間 | ⭐⭐低 |
| **SQL形式に変換** | 約170-260MB | ❌ **不可能** | - | ❌ 高 |

---

## 🎯 推奨方法

### 推奨: pg_restoreコマンドを使用

**理由**:
1. ✅ 現在のファイル形式（約65.85MB）に対応
2. ✅ データ整合性が保証される
3. ✅ インデックス、制約、トリガーも含まれる
4. ✅ 大規模データに対応
5. ✅ 一度のコマンドで完了

**手順**:
```powershell
# 1. 展開したディレクトリに移動
cd tmp/2026-01-03T15:42Z/fleapay_prod_db

# 2. Supabase接続情報を設定
$SUPABASE_URL = "postgresql://postgres:password@db.xxxxx.supabase.co:5432/postgres"

# 3. pg_restoreでインポート
pg_restore --dbname=$SUPABASE_URL --verbose --clean --no-owner --no-privileges .
```

**所要時間**: 1-3時間（データ量による）

---

## ✅ 結論

**実際のデータ量を確認した結果**:

1. **圧縮ファイル**: **65.85MB**（実際の測定値）
2. **展開後のサイズ**: **87.2MB**（実際の測定値）
3. **SQL形式への変換後**: **約170-260MB**（推定）
4. **最大のファイル**: `3544.dat`（87.02MB）- これが主要なデータテーブル

**SQL形式への変換は実行不可能です。**

**推奨方法**:
- ✅ **pg_restoreコマンドを使用**（最も確実で安全）

**代替方法**（GUI操作を希望する場合）:
- ✅ **Supabase Table EditorでCSVインポート**（時間はかかるがGUI操作可能）

---

**結論**: 実際のデータ量を確認した結果、SQL形式への変換は技術的に不可能です。`pg_restore`コマンドを使用することを強く推奨します。

