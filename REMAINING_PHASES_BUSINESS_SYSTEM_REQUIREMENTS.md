# 残りのフェーズ：社内業務システム必須要件

**作成日**: 2026-01-04  
**対象**: 社内業務システムとしての必須要件分析

---

## 📋 残りのフェーズ一覧

| Phase | フェーズ名 | 社内業務システムでの必須度 | 理由 |
|-------|----------|----------------------|------|
| **Phase 1.7** | RLS実装 | 🔴 **必須** | データアクセス制御、セキュリティ |
| **Phase 3.2** | Sentry導入（エラー監視） | 🔴 **必須** | 障害対応、トラブルシューティング |
| **Phase 3.3** | Cloudflare WAF設定 | 🔴 **必須** | セキュリティ、DDoS対策 |
| **Phase 3.4** | 詳細ヘルスチェック + 自動ロールバック | 🟡 **推奨** | 運用自動化、可用性向上 |
| **Phase 3.5** | Langfuse + Promptfoo導入 | 🟢 **任意** | LLM観測・評価（AI機能がある場合のみ） |

---

## 🔴 必須フェーズ（3個）

### 1. Phase 1.7: RLS実装

**必須度**: 🔴 **必須**

**理由**:
- **データアクセス制御**: 社内業務システムでは、ユーザーごとにアクセス可能なデータを制限する必要がある
- **セキュリティ**: データ漏洩防止、不正アクセス防止
- **コンプライアンス**: 個人情報保護法、GDPR等の法的要件に対応
- **マルチテナント対応**: 部署・プロジェクト単位でのデータ分離

**実装内容**:
- Supabase RLS（Row Level Security）有効化
- テーブルごとのRLSポリシー作成
- ユーザーロールベースのアクセス制御

**実装工数**: 2-3時間

**優先度**: **最優先**

---

### 2. Phase 3.2: Sentry導入（エラー監視）

**必須度**: 🔴 **必須**

**理由**:
- **障害対応**: エラー発生時の迅速な検知・対応
- **トラブルシューティング**: エラーログの収集・分析
- **可用性向上**: 問題の早期発見によるダウンタイム削減
- **運用効率化**: エラー通知による迅速な対応

**実装内容**:
- Sentry SDK導入
- エラートラッキング設定
- 通知設定（Slack、メール等）

**実装工数**: 2-3時間

**優先度**: **高**

**注意**: 本番環境のみ導入（検証環境には不要）

---

### 3. Phase 3.3: Cloudflare WAF設定

**必須度**: 🔴 **必須**

**理由**:
- **セキュリティ**: SQLインジェクション、XSS等の攻撃対策
- **DDoS対策**: 大規模なDDoS攻撃からの保護
- **レート制限**: APIの過剰なリクエスト防止
- **IP制限**: 社内IPアドレスのみアクセス許可（オプション）

**実装内容**:
- Cloudflare WAF設定
- セキュリティルール設定
- レート制限設定

**実装工数**: 1-2時間

**優先度**: **高**

**注意**: 本番環境のみ導入（検証環境には不要）

---

## 🟡 推奨フェーズ（1個）

### 4. Phase 3.4: 詳細ヘルスチェック + 自動ロールバック

**必須度**: 🟡 **推奨**

**理由**:
- **運用自動化**: 手動介入なしでの障害対応
- **可用性向上**: 自動ロールバックによるダウンタイム削減
- **運用効率化**: 24時間365日の監視不要

**実装内容**:
- 詳細ヘルスチェック実装
- 自動ロールバック機能実装
- 監視ダッシュボード作成

**実装工数**: 4-6時間

**優先度**: **中**

**判断基準**:
- ✅ **推奨**: 24時間365日稼働が必要なシステム
- ⚠️ **任意**: 営業時間内のみ稼働で十分なシステム

---

## 🟢 任意フェーズ（1個）

### 5. Phase 3.5: Langfuse + Promptfoo導入

**必須度**: 🟢 **任意**

**理由**:
- **LLM観測・評価**: AI機能（画像分析、画像編集等）の品質管理
- **コスト管理**: LLM APIの使用量・コスト監視
- **品質向上**: プロンプトの最適化、評価

**実装内容**:
- Langfuse導入（LLM観測）
- Promptfoo導入（プロンプト評価）
- ダッシュボード設定

**実装工数**: 2.5-4時間

**優先度**: **低**

**判断基準**:
- ✅ **推奨**: AI機能が主要機能で、品質管理が重要なシステム
- ⚠️ **任意**: AI機能が補助的な機能で、品質管理が不要なシステム

**現在のシステム**: AI機能（画像分析、画像編集）を使用しているため、**推奨**レベル

---

## 📊 優先順位まとめ

### 最優先（必須）

1. **Phase 1.7: RLS実装** 🔴
   - セキュリティ・データアクセス制御
   - 実装工数: 2-3時間

2. **Phase 3.2: Sentry導入** 🔴
   - エラー監視・障害対応
   - 実装工数: 2-3時間

3. **Phase 3.3: Cloudflare WAF設定** 🔴
   - セキュリティ・DDoS対策
   - 実装工数: 1-2時間

**合計工数**: 5-8時間

---

### 推奨（運用自動化）

4. **Phase 3.4: 詳細ヘルスチェック + 自動ロールバック** 🟡
   - 運用自動化・可用性向上
   - 実装工数: 4-6時間

---

### 任意（AI機能がある場合）

5. **Phase 3.5: Langfuse + Promptfoo導入** 🟢
   - LLM観測・評価
   - 実装工数: 2.5-4時間

---

## 🎯 社内業務システムとしての推奨実装順序

### Step 1: セキュリティ強化（必須）

1. **Phase 1.7: RLS実装** 🔴
   - データアクセス制御
   - セキュリティ強化

2. **Phase 3.3: Cloudflare WAF設定** 🔴
   - セキュリティ・DDoS対策

**合計工数**: 3-5時間

---

### Step 2: 監視・運用（必須）

3. **Phase 3.2: Sentry導入** 🔴
   - エラー監視・障害対応

**合計工数**: 2-3時間

---

### Step 3: 運用自動化（推奨）

4. **Phase 3.4: 詳細ヘルスチェック + 自動ロールバック** 🟡
   - 運用自動化・可用性向上

**合計工数**: 4-6時間

---

### Step 4: AI機能の品質管理（任意）

5. **Phase 3.5: Langfuse + Promptfoo導入** 🟢
   - LLM観測・評価

**合計工数**: 2.5-4時間

---

## 📋 チェックリスト

### 必須要件

- [ ] **Phase 1.7: RLS実装** 🔴
  - [ ] RLS有効化
  - [ ] テーブルごとのRLSポリシー作成
  - [ ] ユーザーロールベースのアクセス制御

- [ ] **Phase 3.2: Sentry導入** 🔴
  - [ ] Sentry SDK導入
  - [ ] エラートラッキング設定
  - [ ] 通知設定

- [ ] **Phase 3.3: Cloudflare WAF設定** 🔴
  - [ ] Cloudflare WAF設定
  - [ ] セキュリティルール設定
  - [ ] レート制限設定

### 推奨要件

- [ ] **Phase 3.4: 詳細ヘルスチェック + 自動ロールバック** 🟡
  - [ ] 詳細ヘルスチェック実装
  - [ ] 自動ロールバック機能実装
  - [ ] 監視ダッシュボード作成

### 任意要件

- [ ] **Phase 3.5: Langfuse + Promptfoo導入** 🟢
  - [ ] Langfuse導入
  - [ ] Promptfoo導入
  - [ ] ダッシュボード設定

---

## 🎯 結論

**社内業務システムとして必須のフェーズ: 3個**

1. ✅ **Phase 1.7: RLS実装** 🔴
2. ✅ **Phase 3.2: Sentry導入** 🔴
3. ✅ **Phase 3.3: Cloudflare WAF設定** 🔴

**合計実装工数**: 5-8時間

**推奨実装順序**:
1. RLS実装（セキュリティ）
2. Cloudflare WAF設定（セキュリティ）
3. Sentry導入（監視）

**これらを実装することで、社内業務システムとして必要なセキュリティと監視機能が整います。**


