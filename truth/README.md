# Truth（正：Source of Truth）

このディレクトリは、プロジェクトにおける **唯一の正（Source of Truth）** です。

## 定義

**Truth** とは：
- 数値
- 条件
- 制約
- 閾値
- ビジネスルール

これらは **すべてここに記載** されます。

## 原則

### F1: 正は構造化にしか存在しない

数値・条件・制約は、YAML形式の構造化ファイルにのみ存在します。

- ✅ YAML ファイルに記載
- ❌ Markdown / HTML / コメント に記載
- ❌ 自然言語で記載

### なぜ構造化か

1. **AI の推測余地を排除** - パース可能な形式のみ
2. **人間の読み違いを防止** - 曖昧性がない
3. **Git 差分が意味を持つ** - 数値変更が一目瞭然
4. **CI で検証可能** - 機械的にチェック可能

## ディレクトリ構成

### `_index.yml`
すべての truth ファイルの索引です。
新しい truth ファイルを追加したら、必ずここに登録してください。

### `core/`
事業の中核となる指標（KGI/KPI）を記載します。

**例**:
- 継続率目標
- 成長率目標
- 収益目標

### `business/`
ビジネスロジックに関する条件・制約を記載します。

**例**:
- ユーザーフェーズ定義
- リワード条件
- 通知条件

### `ugc/`
UGC（User Generated Content）に関するメトリクスを記載します。

**例**:
- 投稿品質基準
- コンテンツ制約
- モデレーション閾値

### `infra/`
インフラ・システムに関する制約を記載します。

**例**:
- タイムアウト値
- リトライ回数
- レート制限

## YAML 形式のルール

### ✅ 良い例

```yaml
# truth/core/kgi_kpi.yml
retention:
  d7_target: 40        # 7日継続率目標（%）
  d30_target: 20       # 30日継続率目標（%）
  
growth:
  dau_mom_target: 15   # DAU 月次成長率目標（%）
```

### ❌ 悪い例

```yaml
# truth/core/kgi_kpi.yml
retention:
  target: "高い継続率を目指す"  # ← 曖昧
  
growth:
  target: "急成長"              # ← 数値がない
```

## 変更管理

### truth の変更は影響が大きい

truth の変更は、実装・テスト・ドキュメントすべてに影響します。

### 変更プロセス

1. **ADR を作成** - なぜ変更するのか
2. **影響範囲を確認** - CI の Impact Analysis を実行
3. **PR を作成** - レビューを受ける
4. **CI を通過** - 自動検証をパス
5. **マージ** - 変更を反映

### CI による検証

- **Deterministic Check** - 構造の正しさ
- **Generative Check** - 実装との整合性
- **Impact Analysis** - 変更の影響範囲

## AI の参照順序

AI は以下の順序で参照します：

1. **truth/** ← 最優先
2. spec/
3. adr/
4. docs/

## よくある質問

### Q: docs に数値を書きたい場合は？

A: 書けません。truth に書いて、docs からは参照してください。

```markdown
<!-- docs/strategy/retention.md -->
# 継続率戦略

目標値については `truth/core/kgi_kpi.yml` を参照してください。
```

### Q: 「おおよそ」「だいたい」の値を書きたい

A: 書けません。曖昧な値は truth ではありません。
   明確な数値を定義するか、範囲を定義してください。

```yaml
# ✅ 良い例
timeout:
  min: 3000  # ms
  max: 5000  # ms
  default: 4000  # ms
```

### Q: 一時的な実験値を書きたい

A: truth に書いてください。
   ただし、コメントで「実験中」と明記してください。

```yaml
# truth/business/phases.yml
new_user_threshold: 3  # 実験中（2025-01-15まで）
```

## 参照

- 機械仕様: `spec/**`
- 説明・背景: `docs/**`
- 意思決定記録: `adr/**`

